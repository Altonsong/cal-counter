<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dish</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Yuji+Boku&display=swap" rel="stylesheet">

    <style>
        /* 基本样式 */
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            height: 100%; /* 设置HTML和body的高度为视口的100% */
        }

        /* 应用容器样式，确保填满屏幕 */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* 使用视口高度，确保app-container至少和视口一样高 */
        }

        /* 导航栏样式 */
        .top-nav, .bottom-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
        }

        .top-nav h1 {
            font-family: "Yuji Boku";
            font-size: 22px;  /* 减小标题字体大小 */
        }

        .bottom-nav span {
            font-size: 20px;
        }

        /* 主体内容区域样式 */
        .main {
            flex: 1; /* flex: 1让main部分自动填充可用空间 */
            overflow-y: auto; /* 允许内容超出时滚动 */
        }

        .dish-feature img {
            width: 100%;
            height: 250px; /* 设置固定高度 */
            object-fit: cover; /* 添加此行可以让图片按比例填充而不失真 */
        }

        .dish-feature-name {
            margin: 4px 4px;
            padding: 0;
            font-size: 16px; /* 调整字体大小 */
            text-align: left;
        }

        .dish-meta {
            display: flex;
            align-items: center; /* Center items vertically */
            padding: 8px;
            text-align: center;
            justify-content: center;
            border: 1px solid black;
            height: 30px; /* Set the height of the dish-meta to 30px */
            overflow: hidden; /* Ensures no spillover if content is too large */
        }

        .dish-meta > * {
            margin: 0 2px; /* Reduce margin around internal elements */
            padding: 0; /* Remove padding to save space */
        }

        .arrows-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
        }

        .material-symbols-outlined {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arrows-container .material-symbols-outlined {
            display: block;
            font-size: 18px; /* Set arrow icons to be 10x10px */
            line-height: 10px; /* Ensure line height matches for proper alignment */
        }

        .arrows-container .material-symbols-outlined:first-child {
            margin-bottom: 2px; /* Add 2px margin below the up arrow */
        }

        .arrows-container .material-symbols-outlined:last-child {
            margin-top: 0; /* Ensure there is no additional margin above the down arrow */
        }

        span.number-text1 {
            margin-left: 0px; /* 在左侧添加20px的外边距 */
        }

        span.material-symbols-outlined.expand-all {
            font-size: 14px;  /* 设置图标的大小 */
            font-weight: bold;;
        }

        span.number-text2, span.number-text3, span.number-text4 {
            margin-left: 40px; /* 在左侧添加20px的外边距 */
        }

        .dish-menu {
            display: flex;
            padding: 3px;
            justify-content: center;
            gap: 5px;
        }

        .btn {
            background-color: #f8f8f8;
            border: none;
            padding: 10px 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .dish-name {
            margin: 4px 0;
            padding: 0;
            font-size: 14px; /* 调整字体大小 */
            text-align: center;
        }

        /* 菜品列表样式 */
        .dish-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 维持3列布局 */
            gap: 10px; /* 减小网格间距 */
            padding: 10px;
        }

        .dish-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dish-box img {
            width: 100%;
            border-radius: 8px;
        }

        /* 响应式设计：调整更小屏幕布局 */
        @media (max-width: 360px) {
            .dish-list {
                grid-template-columns: repeat(2, 1fr); /* 更小屏幕上改为2列布局 */
                gap: 5px;
            }

            .top-nav h1, .bottom-nav span, .dish-name {
                font-size: 18px; /* 在更小屏幕上进一步减小字体大小 */
            }

            .bottom-nav {
                margin-top: auto; /* 把底部导航栏推到容器的底部 */
            }

            .top-nav, .bottom-nav {
                padding: 10px; /* 在更小屏幕上减小边距 */
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="top-nav">
            <img src="./icons/home.png" alt="Home" style="width:24px;height:24px;">
            <h1 class="dish-page-title">DISH</h1>
            <img src="./icons/info.png" alt="Info" style="width:24px;height:24px;">
        </header>
        <main>
            <div class="dish-feature">
                <img id="feature-image" src="./photos/cucumber-tomato-avocado-salad.webp" alt="Cucumber Tomato Avocado Salad">
                <h2 id="feature-name">Cucumber Tomato Avocado Salad</h2>
                <div class="dish-meta">
                    <span class="number-text1" id="serve-display">1 Serve</span>
                    <div class="arrows-container">
                        <span class="material-symbols-outlined arrow-up">arrow_drop_up</span>
                        <span class="material-symbols-outlined arrow-down">arrow_drop_down</span>
                    </div>
                    <span class="base">150</span>
                    <span class="unit">g</span>
                    <span class="cal">180</span>
                    <span class="text-cal">Cal</span>
                    <span class="material-symbols-outlined number-text4">
                        <img id="addDish" src="./icons/add.png" alt="add" style="width:24px;height:24px;">
                    </span>
                </div>
            </div>
            <div class="dish-menu">
                <button class="btn" onclick="filterDishes('breakfast')">Breakfast</button>
                <button class="btn" onclick="filterDishes('lunch')">Lunch</button>
                <button class="btn" onclick="filterDishes('dinner')">Dinner</button>
                <button class="btn" onclick="filterDishes('snack')">Snack</button>
                <button class="btn" onclick="filterDishes('')">Search</button>
            </div>
            <div class="dish-list"></div>
        </main>
        <footer class="bottom-nav">
            <img id="todayIcon" src="./icons/today.png" alt="today" style="width:24px;height:24px;">
            <img src="./icons/summary.png" alt="summary" style="width:24px;height:24px;">
        </footer>
    </div>

    <script>
    document.getElementById("todayIcon").addEventListener("click", function() {
        window.location.href = "./today.html";
    });

    const dishes = [/* Your existing dish array */];

    function updateDisplay(dish) {
        const featureImage = document.getElementById('feature-image');
        const featureName = document.getElementById('feature-name');
        const cal = document.querySelector('.cal');
        const base = document.querySelector('.base');
        const unit = document.querySelector('.unit');
        const serveDisplay = document.getElementById('serve-display');
        const arrowUp = document.querySelector('.arrow-up');
        const arrowDown = document.querySelector('.arrow-down');
        const addDish = document.getElementById('addDish');

        featureImage.src = dish.image;
        featureImage.alt = dish.name;
        featureName.textContent = dish.name;
        cal.textContent = dish.currentCalories;
        base.textContent = dish.currentGrams;
        unit.textContent = dish.unit;
        serveDisplay.textContent = dish.currentServe + " Serve";

        arrowUp.onclick = () => {
            increaseServing(dish);
            updateDisplay(dish);
        };
        arrowDown.onclick = () => {
            decreaseServing(dish);
            updateDisplay(dish);
        };
        addDish.onclick = () => {
            addDishToToday(dish);
        };
    }

    function increaseServing(dish) {
        if (dish.currentServe + dish.step <= dish.maximum) {
            dish.currentServe += dish.step;
            dish.currentGrams += dish.gramsPerServe * dish.step;
            dish.currentCalories += Math.round(dish.caloriesPerServe * dish.step);
        }
    }

    function decreaseServing(dish) {
        if (dish.currentServe - dish.step >= dish.minimum) {
            dish.currentServe -= dish.step;
            dish.currentGrams -= dish.gramsPerServe * dish.step;
            dish.currentCalories -= Math.round(dish.caloriesPerServe * dish.step);
        }
    }

    function createDishBox(dish) {
        const box = document.createElement('div');
        box.className = 'dish-box';
        box.innerHTML = `<img src="${dish.image}" alt="${dish.name}"><p class="dish-name">${dish.name}</p>`;
        box.addEventListener('click', () => updateDisplay(dish));
        return box;
    }

    function filterDishes(type) {
        const dishList = document.querySelector('.dish-list');
        dishList.innerHTML = '';

        const filteredDishes = dishes.filter(dish => dish.type.includes(type) || type === '');
        filteredDishes.forEach(dish => dishList.appendChild(createDishBox(dish)));
    }

    document.addEventListener('DOMContentLoaded', function() {
        filterDishes('');
    });

    function addDishToToday(dish) {
        fetch('/api/today', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: dish.name,
                image: dish.image,
                serve: dish.currentServe,
                calories: dish.currentCalories,
                time: new Date().toLocaleTimeString()
            })
        })
        .then(response => response.json())
        .then(data => {
            alert('Dish added to Today!');
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    </script>
</body>
</html>
